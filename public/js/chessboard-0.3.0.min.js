/*! chessboard.js v0.3.0 | (c) 2013 Chris Oakman | MIT License chessboardjs.com/license */
(function(){function l(f){return"string"!==typeof f?!1:-1!==f.search(/^[a-h][1-8]$/)}function Q(f){if("string"!==typeof f)return!1;f=f.replace(/ .+$/,"");f=f.split("/");if(8!==f.length)return!1;for(var b=0;8>b;b++)if(""===f[b]||8<f[b].length||-1!==f[b].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function F(f){if("object"!==typeof f)return!1;for(var b in f)if(!0===f.hasOwnProperty(b)){var n;(n=!0!==l(b))||(n=f[b],n="string"!==typeof n?!1:-1!==n.search(/^[bw][KQRNBP]$/),n=!0!==n);if(n)return!1}return!0}
function K(f){if(!0!==Q(f))return!1;f=f.replace(/ .+$/,"");f=f.split("/");for(var b={},n=8,m=0;8>m;m++){for(var l=f[m].split(""),s=0,w=0;w<l.length;w++)if(-1!==l[w].search(/[1-8]/))var I=parseInt(l[w],10),s=s+I;else{var I=b,F=B[s]+n,A;A=l[w];A=A.toLowerCase()===A?"b"+A.toUpperCase():"w"+A.toUpperCase();I[F]=A;s++}n--}return b}function L(f){if(!0!==F(f))return!1;for(var b="",n=8,m=0;8>m;m++){for(var l=0;8>l;l++){var s=B[l]+n;!0===f.hasOwnProperty(s)?(s=f[s].split(""),s="w"===s[0]?s[1].toUpperCase():
s[1].toLowerCase(),b+=s):b+="1"}7!==m&&(b+="/");n--}b=b.replace(/11111111/g,"8");b=b.replace(/1111111/g,"7");b=b.replace(/111111/g,"6");b=b.replace(/11111/g,"5");b=b.replace(/1111/g,"4");b=b.replace(/111/g,"3");return b=b.replace(/11/g,"2")}var B="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(f,b){function n(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(a){return(16*Math.random()|0).toString(16)})}function m(a){return JSON.parse(JSON.stringify(a))}function Z(a){a=
a.split(".");return{major:parseInt(a[0],10),minor:parseInt(a[1],10),patch:parseInt(a[2],10)}}function s(a,e,c){if(!0===b.hasOwnProperty("showErrors")&&!1!==b.showErrors){var d="ChessBoard Error "+a+": "+e;"console"===b.showErrors&&"object"===typeof console&&"function"===typeof console.log?(console.log(d),2<=arguments.length&&console.log(c)):"alert"===b.showErrors?(c&&(d+="\n\n"+JSON.stringify(c)),window.alert(d)):"function"===typeof b.showErrors&&b.showErrors(a,e,c)}}function w(a){return"fast"===
a||"slow"===a?!0:parseInt(a,10)+""!==a+""?!1:0<=a}function I(){for(var a=0;a<B.length;a++)for(var b=1;8>=b;b++){var c=B[a]+b;p[c]=c+"-"+n()}b="KQRBNP".split("");for(a=0;a<b.length;a++){var c="w"+b[a],d="b"+b[a];M[c]=c+"-"+n();M[d]=d+"-"+n()}}function ha(){var a='<div class="'+h.chessboard+'">';!0===b.sparePieces&&(a+='<div class="'+h.sparePieces+" "+h.sparePiecesTop+'"></div>');a+='<div class="'+h.board+'"></div>';!0===b.sparePieces&&(a+='<div class="'+h.sparePieces+" "+h.sparePiecesBottom+'"></div>');
return a+"</div>"}function A(a){"black"!==a&&(a="white");var e="",c=m(B),d=8;"black"===a&&(c.reverse(),d=1);for(var C="white",f=0;8>f;f++){for(var e=e+('<div class="'+h.row+'">'),k=0;8>k;k++){var g=c[k]+d,e=e+('<div class="'+h.square+" "+h[C]+" square-"+g+'" style="width: '+q+"px; height: "+q+'px" id="'+p[g]+'" data-square="'+g+'">');if(!0===b.showNotation){if("white"===a&&1===d||"black"===a&&8===d)e+='<div class="'+h.notation+" "+h.alpha+'">'+c[k]+"</div>";0===k&&(e+='<div class="'+h.notation+" "+
h.numeric+'">'+d+"</div>")}e+="</div>";C="white"===C?"black":"white"}e+='<div class="'+h.clearfix+'"></div></div>';C="white"===C?"black":"white";"white"===a?d--:d++}return e}function R(a){if(S[a])return S[a];"function"===typeof b.pieceTheme?a=b.pieceTheme(a):"string"===typeof b.pieceTheme?a=b.pieceTheme.replace(/{piece}/g,a):(s(8272,"Unable to build image source for cfg.pieceTheme."),a="");return a}function D(a,b,c){var d='<img src="'+R(a)+'" ';c&&"string"===typeof c&&(d+='id="'+c+'" ');d+='alt="" class="'+
h.piece+'" data-piece="'+a+'" style="width: '+q+"px;height: "+q+"px;";!0===b&&(d+="display:none;");return d+'" />'}function N(a){var b="wK wQ wR wB wN wP".split(" ");"black"===a&&(b="bK bQ bR bB bN bP".split(" "));a="";for(var c=0;c<b.length;c++)a+=D(b[c],!1,M[b[c]]);return a}function ia(a,e,c,d){a=$("#"+p[a]);var C=a.offset(),f=$("#"+p[e]);e=f.offset();var k=n();$("body").append(D(c,!0,k));var g=$("#"+k);g.css({display:"",position:"absolute",top:C.top,left:C.left});a.find("."+h.piece).remove();g.animate(e,
{duration:b.moveSpeed,complete:function(){f.append(D(c));g.remove();"function"===typeof d&&d()}})}function ja(a,e,c){var d=$("#"+M[a]).offset(),f=$("#"+p[e]);e=f.offset();var g=n();$("body").append(D(a,!0,g));var k=$("#"+g);k.css({display:"",position:"absolute",left:d.left,top:d.top});k.animate(e,{duration:b.moveSpeed,complete:function(){f.find("."+h.piece).remove();f.append(D(a));k.remove();"function"===typeof c&&c()}})}function ka(a,e,c){function d(){f++;if(f===a.length&&(G(),!0===b.hasOwnProperty("onMoveEnd")&&
"function"===typeof b.onMoveEnd))b.onMoveEnd(m(e),m(c))}for(var f=0,g=0;g<a.length;g++)"clear"===a[g].type&&$("#"+p[a[g].square]+" ."+h.piece).fadeOut(b.trashSpeed,d),"add"===a[g].type&&!0!==b.sparePieces&&$("#"+p[a[g].square]).append(D(a[g].piece,!0)).find("."+h.piece).fadeIn(b.appearSpeed,d),"add"===a[g].type&&!0===b.sparePieces&&ja(a[g].piece,a[g].square,d),"move"===a[g].type&&ia(a[g].source,a[g].destination,a[g].piece,d)}function la(a,b){a=a.split("");var c=B.indexOf(a[0])+1,d=parseInt(a[1],10);
b=b.split("");var g=B.indexOf(b[0])+1,f=parseInt(b[1],10),c=Math.abs(c-g),d=Math.abs(d-f);return c>=d?c:d}function ma(a){for(var b=[],c=0;8>c;c++)for(var d=0;8>d;d++){var g=B[c]+(d+1);a!==g&&b.push({square:g,distance:la(a,g)})}b.sort(function(a,b){return a.distance-b.distance});a=[];for(c=0;c<b.length;c++)a.push(b[c].square);return a}function G(){x.find("."+h.piece).remove();for(var a in g)!0===g.hasOwnProperty(a)&&$("#"+p[a]).append(D(g[a]))}function T(){x.html(A(u));G();!0===b.sparePieces&&("white"===
u?(U.html(N("black")),V.html(N("white"))):(U.html(N("white")),V.html(N("black"))))}function O(a){var e=m(g),c=m(a),d=L(e),f=L(c);if(d!==f){if(!0===b.hasOwnProperty("onChange")&&"function"===typeof b.onChange)b.onChange(e,c);g=a}}function W(a,b){for(var c in J)if(!0===J.hasOwnProperty(c)){var d=J[c];if(a>=d.left&&a<d.left+q&&b>=d.top&&b<d.top+q)return c}return"offboard"}function X(){x.find("."+h.square).removeClass(h.highlight1+" "+h.highlight2)}function na(){function a(){G();y.css("display","none");
if(!0===b.hasOwnProperty("onSnapbackEnd")&&"function"===typeof b.onSnapbackEnd)b.onSnapbackEnd(E,t,m(g),u)}if("spare"===t)aa();else{X();var e=$("#"+p[t]).offset();y.animate(e,{duration:b.snapbackSpeed,complete:a});z=!1}}function aa(){X();var a=m(g);delete a[t];O(a);G();y.fadeOut(b.trashSpeed);z=!1}function oa(a){X();var e=m(g);delete e[t];e[a]=E;O(e);e=$("#"+p[a]).offset();y.animate(e,{duration:b.snapSpeed,complete:function(){G();y.css("display","none");if(!0===b.hasOwnProperty("onSnapEnd")&&"function"===
typeof b.onSnapEnd)b.onSnapEnd(t,a,E)}});z=!1}function P(a,e,c,d){if("function"!==typeof b.onDragStart||!1!==b.onDragStart(a,e,m(g),u)){z=!0;E=e;t=a;H="spare"===a?"offboard":a;J={};for(var f in p)!0===p.hasOwnProperty(f)&&(J[f]=$("#"+p[f]).offset());y.attr("src",R(e)).css({display:"",position:"absolute",left:c-q/2,top:d-q/2});"spare"!==a&&$("#"+p[a]).addClass(h.highlight1).find("."+h.piece).css("display","none")}}function ba(a,e){y.css({left:a-q/2,top:e-q/2});var c=W(a,e);if(c!==H){!0===l(H)&&$("#"+
p[H]).removeClass(h.highlight2);!0===l(c)&&$("#"+p[c]).addClass(h.highlight2);if("function"===typeof b.onDragMove)b.onDragMove(c,H,t,E,m(g),u);H=c}}function ca(a){var e="drop";"offboard"===a&&"snapback"===b.dropOffBoard&&(e="snapback");"offboard"===a&&"trash"===b.dropOffBoard&&(e="trash");if(!0===b.hasOwnProperty("onDrop")&&"function"===typeof b.onDrop){var c=m(g);"spare"===t&&!0===l(a)&&(c[a]=E);!0===l(t)&&"offboard"===a&&delete c[t];!0===l(t)&&!0===l(a)&&(delete c[t],c[a]=E);var d=m(g),c=b.onDrop(t,
a,E,c,d,u);if("snapback"===c||"trash"===c)e=c}"snapback"===e?na():"trash"===e?aa():"drop"===e&&oa(a)}function pa(a){a.preventDefault()}function qa(a){if(!0===b.draggable){var e=$(this).attr("data-square");!0===l(e)&&!0===g.hasOwnProperty(e)&&P(e,g[e],a.pageX,a.pageY)}}function ra(a){if(!0===b.draggable){var e=$(this).attr("data-square");!0===l(e)&&!0===g.hasOwnProperty(e)&&(a=a.originalEvent,P(e,g[e],a.changedTouches[0].pageX,a.changedTouches[0].pageY))}}function sa(a){if(!0===b.sparePieces){var e=
$(this).attr("data-piece");P("spare",e,a.pageX,a.pageY)}}function ta(a){if(!0===b.sparePieces){var e=$(this).attr("data-piece");a=a.originalEvent;P("spare",e,a.changedTouches[0].pageX,a.changedTouches[0].pageY)}}function da(a){!0===z&&ba(a.pageX,a.pageY)}function ua(a){!0===z&&(a.preventDefault(),ba(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))}function ea(a){!0===z&&(a=W(a.pageX,a.pageY),ca(a))}function va(a){!0===z&&(a=W(a.originalEvent.changedTouches[0].pageX,
a.originalEvent.changedTouches[0].pageY),ca(a))}function wa(a){if(!1===z&&!0===b.hasOwnProperty("onMouseoverSquare")&&"function"===typeof b.onMouseoverSquare&&(a=$(a.currentTarget).attr("data-square"),!0===l(a))){var e=!1;!0===g.hasOwnProperty(a)&&(e=g[a]);b.onMouseoverSquare(a,e,m(g),u)}}function xa(a){if(!1===z&&!0===b.hasOwnProperty("onMouseoutSquare")&&"function"===typeof b.onMouseoutSquare&&(a=$(a.currentTarget).attr("data-square"),!0===l(a))){var e=!1;!0===g.hasOwnProperty(a)&&(e=g[a]);b.onMouseoutSquare(a,
e,m(g),u)}}function ya(){$("body").on("mousedown mousemove","."+h.piece,pa);x.on("mousedown","."+h.square,qa);v.on("mousedown","."+h.sparePieces+" ."+h.piece,sa);x.on("mouseenter","."+h.square,wa);x.on("mouseleave","."+h.square,xa);!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",da),$("body").on("mouseup",ea)):($(window).on("mousemove",da),$(window).on("mouseup",ea));!0==="ontouchstart"in document.documentElement&&
(x.on("touchstart","."+h.square,ra),v.on("touchstart","."+h.sparePieces+" ."+h.piece,ta),$(window).on("touchmove",ua),$(window).on("touchend",va))}function za(){v.html(ha());x=v.find("."+h.board);!0===b.sparePieces&&(U=v.find("."+h.sparePiecesTop),V=v.find("."+h.sparePiecesBottom));var a=n();$("body").append(D("wP",!0,a));y=$("#"+a);fa=parseInt(x.css("borderLeftWidth"),10);r.resize()}b=b||{};var ga=K("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),h={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",
chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},v,x,y,U,V,r={},fa=2,u="white",g={},q,E,H,t,z=!1,M={},p={},J,S={};r.clear=function(a){r.position({},a)};r.destroy=function(){v.html("");y.remove();
v.unbind()};r.fen=function(){return r.position("fen")};r.flip=function(){r.orientation("flip")};r.cache=function(){"wK wQ wR wB wN wP bK bQ bR bB bN bP".split(" ").forEach(function(a){var b=new Image;b.onload=function(){var c=S,d=document.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(b,0,0);d=d.toDataURL("image/png");c[a]=d};b.src=R(a)})};r.move=function(){if(0!==arguments.length){for(var a=!0,b={},c=0;c<arguments.length;c++)if(!1===arguments[c])a=!1;else{var d;
d=arguments[c];"string"!==typeof d?d=!1:(d=d.split("-"),d=2!==d.length?!1:!0===l(d[0])&&!0===l(d[1]));!0!==d?s(2826,"Invalid move passed to the move method.",arguments[c]):(d=arguments[c].split("-"),b[d[0]]=d[1])}var c=g,c=m(c),f;for(f in b)!0===b.hasOwnProperty(f)&&!0===c.hasOwnProperty(f)&&(d=c[f],delete c[f],c[b[f]]=d);b=c;r.position(b,a);return b}};r.orientation=function(a){if(0===arguments.length)return u;"white"===a||"black"===a?(u=a,T()):"flip"===a?(u="white"===u?"black":"white",T()):s(5482,
"Invalid value passed to the orientation method.",a)};r.position=function(a,b){if(0===arguments.length)return m(g);if("string"===typeof a&&"fen"===a.toLowerCase())return L(g);!1!==b&&(b=!0);"string"===typeof a&&"start"===a.toLowerCase()&&(a=m(ga));!0===Q(a)&&(a=K(a));if(!0!==F(a))s(6482,"Invalid value passed to the position method.",a);else if(!0===b){var c=g,d=a,c=m(c),d=m(d),f=[],h={},k;for(k in d)!0===d.hasOwnProperty(k)&&!0===c.hasOwnProperty(k)&&c[k]===d[k]&&(delete c[k],delete d[k]);for(k in d)if(!0===
d.hasOwnProperty(k)){var l;a:{l=c;for(var n=d[k],r=ma(k),p=0;p<r.length;p++){var q=r[p];if(!0===l.hasOwnProperty(q)&&l[q]===n){l=q;break a}}l=!1}!1!==l&&(f.push({type:"move",source:l,destination:k,piece:d[k]}),delete c[l],delete d[k],h[k]=!0)}for(k in d)!0===d.hasOwnProperty(k)&&(f.push({type:"add",square:k,piece:d[k]}),delete d[k]);for(k in c)!0===c.hasOwnProperty(k)&&!0!==h.hasOwnProperty(k)&&(f.push({type:"clear",square:k,piece:c[k]}),delete c[k]);ka(f,g,a);O(a)}else O(a),G()};r.resize=function(){var a=
parseInt(v.css("width"),10);if(!a||0>=a)q=0;else{for(a-=1;0!==a%8&&0<a;)a--;q=a/8}x.css("width",8*q+"px");y.css({height:q,width:q});!0===b.sparePieces&&v.find("."+h.sparePieces).css("paddingLeft",q+fa+"px");T()};r.start=function(a){r.position("start",a)};var Y;if(Y=!0===function(){if("string"===typeof f){if(""===f)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var a=document.getElementById(f);if(!a)return window.alert('ChessBoard Error 1002: Element with id "'+
f+'" does not exist in the DOM.\n\nExiting...'),!1;v=$(a)}else if(v=$(f),1!==v.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;if(!window.JSON||"function"!==typeof JSON.stringify||"function"!==typeof JSON.parse)return window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1;if(a=typeof window.$)if(a=$.fn)if(a=$.fn.jquery)var a=$.fn.jquery,b="1.7.0",a=Z(a),
b=Z(b),a=!0===1E8*a.major+1E4*a.minor+a.patch>=1E8*b.major+1E4*b.minor+b.patch;return a?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."),!1)}()){if("string"===typeof b||!0===F(b))b={position:b};"black"!==b.orientation&&(b.orientation="white");u=b.orientation;!1!==b.showNotation&&(b.showNotation=!0);!0!==b.draggable&&(b.draggable=!1);"trash"!==b.dropOffBoard&&(b.dropOffBoard="snapback");!0!==b.sparePieces&&
(b.sparePieces=!1);!0===b.sparePieces&&(b.draggable=!0);if(!0!==b.hasOwnProperty("pieceTheme")||"string"!==typeof b.pieceTheme&&"function"!==typeof b.pieceTheme)b.pieceTheme="img/chesspieces/wikipedia/{piece}.png";if(!0!==b.hasOwnProperty("appearSpeed")||!0!==w(b.appearSpeed))b.appearSpeed=200;if(!0!==b.hasOwnProperty("moveSpeed")||!0!==w(b.moveSpeed))b.moveSpeed=200;if(!0!==b.hasOwnProperty("snapbackSpeed")||!0!==w(b.snapbackSpeed))b.snapbackSpeed=50;if(!0!==b.hasOwnProperty("snapSpeed")||!0!==w(b.snapSpeed))b.snapSpeed=
25;if(!0!==b.hasOwnProperty("trashSpeed")||!0!==w(b.trashSpeed))b.trashSpeed=100;!0===b.hasOwnProperty("position")&&("start"===b.position?g=m(ga):!0===Q(b.position)?g=K(b.position):!0===F(b.position)?g=m(b.position):s(7263,"Invalid value passed to config.position.",b.position));Y=!0}Y&&(I(),za(),ya());return r};window.ChessBoard.fenToObj=K;window.ChessBoard.objToFen=L})();
